<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCIC CORE | Sistema Integral de Gesti√≥n Universitaria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; color: #1e293b; }
        .sidebar-item { transition: 0.2s; border-radius: 12px; cursor: pointer; color: #64748b; }
        .sidebar-item:hover { background: #f1f5f9; color: #ea580c; }
        .active-nav { background: #ea580c !important; color: white !important; box-shadow: 0 10px 15px -3px rgba(234, 88, 12, 0.3); }
        .glass-panel { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid #e2e8f0; }
        select, input { border: 1px solid #e2e8f0 !important; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <div id="login-screen" class="fixed inset-0 z-[100] bg-slate-900 flex items-center justify-center p-6">
        <div class="bg-white p-10 rounded-[3rem] w-full max-w-md shadow-2xl text-center border border-slate-700">
            <h2 class="text-3xl font-extrabold mb-2 italic">UCIC <span class="text-orange-600">ERP</span></h2>
            <p class="text-slate-400 text-sm mb-8">Ingresa con tu cuenta institucional</p>
            <input type="email" id="auth-email" placeholder="usuario@ucic.edu.mx" class="w-full p-4 bg-slate-50 rounded-2xl mb-4 outline-none focus:ring-2 focus:ring-orange-500 font-bold text-center">
            <button onclick="handleLogin()" class="w-full bg-slate-900 text-white font-bold py-4 rounded-2xl hover:bg-orange-600 transition-all shadow-lg">Entrar al Sistema</button>
        </div>
    </div>

    <nav class="w-72 bg-white border-r border-slate-200 flex flex-col p-6 space-y-8 z-40">
        <div class="px-2">
            <h1 class="text-2xl font-black italic tracking-tighter">UCIC <span class="text-orange-600">CORE</span></h1>
            <p class="text-[9px] font-bold text-slate-400 uppercase tracking-[0.3em]">Gesti√≥n Universitaria v2.0</p>
        </div>
        <div class="space-y-2 flex-1">
            <div onclick="switchView('dashboard')" id="nav-dashboard" class="sidebar-item p-4 flex items-center gap-3 font-bold text-sm active-nav"><i class="fa-solid fa-chart-pie"></i> Dashboard</div>
            <div onclick="switchView('academico')" id="nav-academico" class="sidebar-item p-4 flex items-center gap-3 font-bold text-sm"><i class="fa-solid fa-graduation-cap"></i> Control Acad√©mico</div>
            <div onclick="switchView('leads')" id="nav-leads" class="sidebar-item p-4 flex items-center gap-3 font-bold text-sm"><i class="fa-solid fa-bolt"></i> Leads de Admisiones</div>
        </div>
        <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100">
            <p id="user-display" class="text-xs font-black truncate uppercase text-slate-500">Sesi√≥n iniciada</p>
            <button onclick="location.reload()" class="text-[10px] font-bold text-red-500 mt-2 uppercase hover:underline">Cerrar Sesi√≥n</button>
        </div>
    </nav>

    <main class="flex-1 flex flex-col relative">
        <header class="h-20 bg-white/50 backdrop-blur-md border-b border-slate-200 flex items-center justify-between px-10">
            <h2 id="view-title" class="text-xl font-extrabold uppercase tracking-tight text-slate-800 italic">Dashboard</h2>
            <div id="server-status" class="flex items-center gap-2 text-[10px] font-black px-3 py-1 rounded-full bg-red-100 text-red-600 transition-all">
                <i class="fa-solid fa-circle text-[6px]"></i> SERVIDOR LOCAL: DESCONECTADO
            </div>
        </header>

        <section id="viewport" class="p-10 overflow-y-auto h-full">
            
            <div id="view-dashboard" class="view-content space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-200">
                        <p class="text-slate-400 text-[10px] font-black uppercase">Alumnos Activos</p>
                        <h3 id="count-alumnos" class="text-4xl font-black mt-2">0</h3>
                    </div>
                    <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-200">
                        <p class="text-slate-400 text-[10px] font-black uppercase">Conversi√≥n n8n</p>
                        <h3 class="text-4xl font-black mt-2 text-orange-600">32%</h3>
                    </div>
                    <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-200">
                        <p class="text-slate-400 text-[10px] font-black uppercase">Ingresos Mensuales</p>
                        <h3 class="text-4xl font-black mt-2 text-blue-600">$4.2M</h3>
                    </div>
                </div>
                <div class="bg-white p-10 rounded-[3rem] border border-slate-200 shadow-sm">
                    <canvas id="chartGlobal" height="100"></canvas>
                </div>
            </div>

            <div id="view-academico" class="view-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    <div class="lg:col-span-1">
                        <div class="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-xl sticky top-0">
                            <h3 class="font-black text-orange-600 mb-6 uppercase text-sm italic">Inscripci√≥n Oficial</h3>
                            <div class="space-y-4">
                                <input id="ins-nombre" type="text" placeholder="Nombre completo" class="w-full p-4 bg-slate-50 rounded-2xl outline-none focus:ring-2 focus:ring-orange-500 font-bold">
                                <select id="ins-carrera" class="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-sm">
                                    <option value="Cinematograf√≠a">Lic. Cinematograf√≠a</option>
                                    <option value="Dise√±o Automotriz">Ing. Dise√±o Automotriz</option>
                                    <option value="Derecho">Lic. Derecho</option>
                                    <option value="Software">Ing. de Software</option>
                                    <option value="Administraci√≥n">Lic. Administraci√≥n</option>
                                    <option value="Animaci√≥n Digital">Lic. Animaci√≥n Digital</option>
                                    <option value="Direcci√≥n de Ventas">Lic. Direcci√≥n de Ventas</option>
                                </select>
                                <input id="ins-mat" type="text" placeholder="Matr√≠cula (Ej: 2026-001)" class="w-full p-4 bg-slate-50 rounded-2xl outline-none">
                                <button onclick="inscribir()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-orange-600 transition-all">Sincronizar e Inscribir</button>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-3">
                        <div class="bg-white rounded-[2rem] border border-slate-200 overflow-hidden shadow-sm">
                            <table class="w-full text-left">
                                <thead class="bg-slate-50 border-b border-slate-100 text-[10px] font-black text-slate-400 uppercase tracking-widest">
                                    <tr><th class="p-6">Expediente del Alumno</th><th class="p-6">Programa Acad√©mico</th><th class="p-6 text-right">Acciones</th></tr>
                                </thead>
                                <tbody id="tabla-alumnos" class="divide-y divide-slate-50 font-bold"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </section>

        <div id="panel-horarios" class="fixed inset-0 z-50 bg-slate-950/95 hidden overflow-y-auto p-10 flex items-center justify-center">
            <div class="max-w-4xl w-full bg-white rounded-[3rem] p-12 shadow-2xl relative">
                <button onclick="document.getElementById('panel-horarios').classList.add('hidden')" class="absolute top-8 right-8 text-slate-400 hover:text-orange-600 text-2xl transition-all"><i class="fa-solid fa-circle-xmark"></i></button>
                <div class="mb-10">
                    <h3 id="horario-nombre" class="text-4xl font-extrabold italic uppercase tracking-tighter">NOMBRE DEL ALUMNO</h3>
                    <p class="text-orange-600 font-black text-[10px] tracking-widest uppercase mt-1">Configuraci√≥n de Horario y Plan de Estudios</p>
                </div>
                <div id="lista-materias" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 max-h-[400px] overflow-y-auto pr-2"></div>
                <div class="flex flex-col md:flex-row gap-4">
                    <button onclick="guardarLocal()" class="flex-1 bg-orange-600 text-white p-5 rounded-2xl font-black uppercase text-xs shadow-lg hover:bg-orange-700 transition-all">Sincronizar con Base de Datos Local</button>
                    <button id="btn-kardex" class="bg-slate-900 text-white p-5 rounded-2xl font-black uppercase text-xs shadow-lg hover:bg-blue-600 transition-all">
                        <i class="fa-solid fa-file-pdf mr-2"></i> Generar Kardex Oficial
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_URL = 'http://localhost:3000/api';
        let db_alumnos = [];
        let alumnoIndexActual = null;

        const CARRERAS_DATA = {
            "Cinematograf√≠a": ["Guionismo I", "Direcci√≥n de Fotograf√≠a", "Edici√≥n Digital", "Historia del Cine", "Producci√≥n"],
            "Dise√±o Automotriz": ["Aerodin√°mica", "Motores I", "Dise√±o en Alias", "Materiales Pol√≠meros", "Sistemas El√©ctricos"],
            "Derecho": ["Derecho Romano", "Introducci√≥n al Derecho", "Derecho Civil", "Teor√≠a del Estado", "Penal I"],
            "Software": ["Algoritmos", "Bases de Datos SQL", "Backend Node.js", "Ciberseguridad", "Arquitectura"],
            "Administraci√≥n": ["Gesti√≥n Estrat√©gica", "Contabilidad I", "Marketing", "Finanzas"],
            "Animaci√≥n Digital": ["Modelado 3D", "Rigging", "Storytelling", "Ilustraci√≥n Digital"],
            "Direcci√≥n de Ventas": ["Neuroventas", "CRM Estrat√©gico", "Key Account Management", "Liderazgo"]
        };

        // LOGIN
        function handleLogin() {
            const mail = document.getElementById('auth-email').value;
            if(mail.includes('@') || mail === 'admin') {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('user-display').innerText = `Admin: ${mail}`;
                initServerCheck();
                initCharts();
            }
        }

        // CHECAR SERVIDOR LOCAL
        async function initServerCheck() {
            try {
                const res = await fetch(`${API_URL}/data`);
                const data = await res.json();
                db_alumnos = data.alumnos || [];
                document.getElementById('server-status').className = "flex items-center gap-2 text-[10px] font-black px-3 py-1 rounded-full bg-green-100 text-green-600";
                document.getElementById('server-status').innerHTML = '<i class="fa-solid fa-circle text-[6px]"></i> SERVIDOR LOCAL: CONECTADO';
                renderAlumnos();
            } catch (e) {
                console.log("Servidor local no detectado");
            }
        }

        // NAVEGACION
        function switchView(id) {
            document.querySelectorAll('.view-content').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active-nav'));
            document.getElementById('view-'+id).classList.remove('hidden');
            document.getElementById('nav-'+id).classList.add('active-nav');
            document.getElementById('view-title').innerText = id.charAt(0).toUpperCase() + id.slice(1);
        }

        // ALTA ALUMNO
        async function inscribir() {
            const alu = {
                nombre: document.getElementById('ins-nombre').value,
                carrera: document.getElementById('ins-carrera').value,
                mat: document.getElementById('ins-mat').value,
                horario: []
            };
            if(!alu.nombre || !alu.mat) return alert("Por favor complete todos los campos");

            try {
                await fetch(`${API_URL}/save-alumno`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(alu)
                });
                db_alumnos.push(alu);
                renderAlumnos();
                alert("‚úÖ Registrado con √©xito en el servidor local.");
                document.getElementById('ins-nombre').value = "";
                document.getElementById('ins-mat').value = "";
            } catch (e) {
                alert("‚ùå Error: Aseg√∫rate de que el servidor local (Node.js) est√© encendido.");
            }
        }

        function renderAlumnos() {
            const t = document.getElementById('tabla-alumnos');
            t.innerHTML = db_alumnos.map((a, i) => `
                <tr class="hover:bg-slate-50 transition-colors">
                    <td class="p-6">
                        <p class="font-black text-slate-800">${a.nombre.toUpperCase()}</p>
                        <p class="text-[9px] text-slate-400 tracking-tighter">MATRICULA: ${a.mat}</p>
                    </td>
                    <td class="p-6 text-xs text-orange-600 uppercase font-black italic tracking-tight">${a.carrera}</td>
                    <td class="p-6 text-right">
                        <button onclick="verHorario(${i})" class="bg-slate-900 text-white hover:bg-orange-600 px-6 py-2 rounded-xl text-[10px] font-black transition-all uppercase tracking-widest shadow-sm">Gestionar</button>
                    </td>
                </tr>
            `).join('');
            document.getElementById('count-alumnos').innerText = db_alumnos.length;
        }

        function verHorario(i) {
            alumnoIndexActual = i;
            const alu = db_alumnos[i];
            document.getElementById('panel-horarios').classList.remove('hidden');
            document.getElementById('horario-nombre').innerText = alu.nombre;
            
            const mats = CARRERAS_DATA[alu.carrera] || ["Materia General 1", "Materia General 2"];
            document.getElementById('lista-materias').innerHTML = mats.map(m => `
                <div class="bg-slate-50 p-5 rounded-3xl border border-slate-100 space-y-3">
                    <p class="text-[10px] font-black uppercase text-slate-400 tracking-widest">${m}</p>
                    <div class="grid grid-cols-2 gap-2">
                        <select class="bg-white border text-[10px] p-2 rounded-xl font-bold outline-none">
                            <option>LUNES - MI√âRCOLES</option><option>MARTES - JUEVES</option><option>S√ÅBADO (SABATINO)</option>
                        </select>
                        <select class="bg-white border text-[10px] p-2 rounded-xl font-bold outline-none">
                            <option>07:00 - 09:00</option><option>09:00 - 11:00</option><option>18:00 - 20:00</option>
                        </select>
                    </div>
                    <select class="w-full bg-slate-900 text-white text-[9px] p-2 rounded-xl font-black uppercase tracking-widest">
                        <option value="presencial">üìç Modalidad Presencial</option><option value="hibrido">üíª Modalidad H√≠brida</option>
                    </select>
                </div>
            `).join('');

            document.getElementById('btn-kardex').onclick = () => generarKardex(i);
        }

        function generarKardex(i) {
            const alu = db_alumnos[i];
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // LOGO PLACEHOLDER
            doc.setFillColor(234, 88, 12);
            doc.rect(20, 15, 10, 10, 'F');

            doc.setFont("helvetica", "bold");
            doc.setFontSize(22); doc.text("UNIVERSIDAD UCIC", 105, 25, { align: "center" });
            doc.setFontSize(9); doc.setFont("helvetica", "normal");
            doc.text("SISTEMA DE GESTI√ìN ACAD√âMICA Y CONTROL ESCOLAR", 105, 32, { align: "center" });
            doc.line(20, 38, 190, 38);

            doc.setFillColor(245, 245, 245);
            doc.rect(20, 45, 170, 35, 'F');
            doc.setFontSize(10); doc.setFont("helvetica", "bold");
            doc.text("EXPEDIENTE DEL ALUMNO", 25, 52);
            doc.setFont("helvetica", "normal");
            doc.text(`NOMBRE: ${alu.nombre.toUpperCase()}`, 25, 60);
            doc.text(`PROGRAMA: ${alu.carrera.toUpperCase()}`, 25, 67);
            doc.text(`MATR√çCULA: ${alu.mat}`, 130, 60);
            doc.text(`PROMEDIO: 9.2 (Global)`, 130, 67);

            doc.setFont("helvetica", "bold");
            doc.text("ASIGNATURA", 25, 95); doc.text("MODALIDAD", 120, 95); doc.text("ESTADO", 160, 95);
            doc.line(20, 98, 190, 98);
            
            doc.setFont("helvetica", "normal");
            let y = 108;
            const mats = CARRERAS_DATA[alu.carrera] || [];
            mats.forEach(m => {
                doc.text(m, 25, y); doc.text("PRESENCIAL", 120, y); doc.text("CURSANDO", 160, y);
                y += 10;
            });

            doc.line(60, 260, 150, 260); 
            doc.setFontSize(8); doc.text("FIRMA DE RECTOR√çA / SELLO INSTITUCIONAL", 105, 265, { align: "center" });
            doc.rect(160, 245, 25, 25); doc.setFontSize(6); doc.text("VALIDACI√ìN QR", 172.5, 273, { align: "center" });

            doc.save(`Kardex_UCIC_${alu.nombre}.pdf`);
        }

        async function guardarLocal() {
            alert("‚ö†Ô∏è Sincronizando estados con el servidor local...");
            document.getElementById('panel-horarios').classList.add('hidden');
        }

        function initCharts() {
            const ctx = document.getElementById('chartGlobal').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: { labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'], datasets: [{ label: 'Nuevos Alumnos', data: [12, 19, 35, 50, 85, 120], borderColor: '#ea580c', tension: 0.4, fill: true, backgroundColor: 'rgba(234, 88, 12, 0.1)' }] },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }
    </script>
</body>
</html>