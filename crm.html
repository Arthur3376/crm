<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP UCIC - Centro de Control Acad√©mico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: white; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .btn-grad { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
    </style>
</head>
<body class="min-h-screen overflow-x-hidden">

    <div id="login-screen" class="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center p-6">
        <div class="glass max-w-md w-full p-8 rounded-[2rem] text-center">
            <div class="mb-6 inline-flex items-center justify-center w-20 h-20 rounded-full bg-orange-500/20 text-orange-500 text-4xl shadow-[0_0_50px_rgba(249,115,22,0.3)]">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
            <h1 class="text-3xl font-black mb-2 tracking-tighter italic">UCIC ACADEMY</h1>
            <p class="text-slate-400 text-sm mb-8">Acceso restringido a personal administrativo</p>
            <input type="email" id="user-mail" placeholder="Usuario / Correo institucional" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-2xl mb-4 focus:ring-2 focus:ring-orange-500 outline-none transition-all">
            <button onclick="intentarEntrar()" class="w-full btn-grad p-4 rounded-2xl font-black uppercase tracking-widest shadow-lg active:scale-95 transition-all">Entrar al Sistema</button>
        </div>
    </div>

    <div class="p-6 lg:p-12 max-w-7xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12">
            <div>
                <h2 class="text-4xl font-black italic tracking-tighter">CONTROL ACAD√âMICO <span class="text-orange-500">UCIC</span></h2>
                <p class="text-slate-400 font-medium">Gesti√≥n Universitaria y CRM</p>
            </div>
            <div class="flex gap-4">
                <button onclick="document.getElementById('modal-inscripcion').classList.remove('hidden')" class="btn-grad px-6 py-3 rounded-2xl font-black text-xs uppercase shadow-xl hover:shadow-orange-500/20 transition-all">
                    <i class="fa-solid fa-user-plus mr-2"></i> Nuevo Alumno
                </button>
            </div>
        </header>

        <div class="glass rounded-[2.5rem] overflow-hidden">
            <table class="w-full text-left">
                <thead>
                    <tr class="border-b border-white/10 bg-white/5">
                        <th class="p-6 text-[10px] font-black uppercase text-slate-400">Alumno / Carrera</th>
                        <th class="p-6 text-[10px] font-black uppercase text-slate-400 text-center">Gesti√≥n Acad√©mica</th>
                    </tr>
                </thead>
                <tbody id="tabla-alumnos">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="modal-inscripcion" class="fixed inset-0 z-50 bg-slate-950/90 backdrop-blur-sm hidden flex items-center justify-center p-6">
        <div class="glass max-w-lg w-full p-8 rounded-[2.5rem] relative">
            <button onclick="this.parentElement.parentElement.classList.add('hidden')" class="absolute top-6 right-6 text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-2xl"></i></button>
            <h3 class="text-2xl font-black mb-6">FORMULARIO DE ADMISI√ìN</h3>
            <div class="space-y-4">
                <input type="text" id="ins-nombre" placeholder="Nombre completo" class="w-full bg-slate-800 p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-orange-500">
                <select id="ins-carrera" class="w-full bg-slate-800 p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-orange-500 appearance-none">
                    <option value="cine">Lic. Cinematograf√≠a</option>
                    <option value="derecho">Lic. Derecho</option>
                    <option value="diseno">Lic. Dise√±o Gr√°fico</option>
                </select>
                <button onclick="inscribir()" class="w-full btn-grad p-4 rounded-2xl font-black uppercase tracking-widest mt-4">Inscribir Alumno</button>
            </div>
        </div>
    </div>

    <div id="panel-horarios" class="fixed inset-0 z-50 bg-slate-950/95 hidden overflow-y-auto p-6 lg:p-20">
        <div class="max-w-4xl mx-auto">
            <header class="flex justify-between items-center mb-10">
                <div>
                    <h4 id="nombre-alumno-horario" class="text-3xl font-black text-orange-500 italic">CARGANDO...</h4>
                    <p class="text-slate-400 font-bold uppercase text-[10px] tracking-[0.3em]">Asignaci√≥n de Materias y Horas</p>
                </div>
                <button onclick="document.getElementById('panel-horarios').classList.add('hidden')" class="bg-white/10 w-12 h-12 rounded-full flex items-center justify-center hover:bg-orange-600 transition-all"><i class="fa-solid fa-chevron-down"></i></button>
            </header>
            
            <div id="lista-materias-disponibles" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-20">
                </div>
        </div>
    </div>

    <script>
        // BASE DE DATOS LOCAL (Simulada hasta conectar el servidor)
        let db_alumnos = [];
        const CARRERAS = {
            cine: ["Producci√≥n Cinematogr√°fica", "Guionismo", "Edici√≥n Digital", "Historia del Cine", "Fotograf√≠a I"],
            derecho: ["Derecho Romano", "Introducci√≥n al Derecho", "Derecho Penal", "Sociolog√≠a Jur√≠dica"],
            diseno: ["Teor√≠a del Color", "Ilustraci√≥n Digital", "Tipograf√≠a", "Semi√≥tica"]
        };

        function intentarEntrar() {
            const mail = document.getElementById('user-mail').value;
            if(mail.includes('@') || mail === 'admin') {
                document.getElementById('login-screen').classList.add('opacity-0', 'pointer-events-none');
                setTimeout(() => document.getElementById('login-screen').remove(), 500);
            } else {
                alert("Acceso denegado. Use su correo @ucic.edu.mx");
            }
        }

        function inscribir() {
            const nom = document.getElementById('ins-nombre').value;
            const car = document.getElementById('ins-carrera').value;
            if(!nom) return alert("Ingrese el nombre");

            db_alumnos.push({ nom, car, horario: [] });
            renderAlumnos();
            document.getElementById('modal-inscripcion').classList.add('hidden');
            document.getElementById('ins-nombre').value = "";
        }

        function renderAlumnos() {
            const t = document.getElementById('tabla-alumnos');
            t.innerHTML = db_alumnos.map((a, i) => `
                <tr class="border-b border-white/5 hover:bg-white/5 transition-colors">
                    <td class="p-6">
                        <div class="font-black text-lg">${a.nom.toUpperCase()}</div>
                        <div class="text-[10px] font-bold text-orange-500 tracking-widest uppercase italic">${a.car}</div>
                    </td>
                    <td class="p-6 text-center">
                        <button onclick="verHorario(${i})" class="bg-blue-600/20 hover:bg-blue-600 text-blue-400 hover:text-white px-4 py-2 rounded-xl text-[10px] font-black transition-all">
                            <i class="fa-solid fa-calendar-days mr-2"></i> HORARIO
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        let alumnoIndexActual = null;

        function verHorario(i) {
            alumnoIndexActual = i;
            const alu = db_alumnos[i];
            const p = document.getElementById('panel-horarios');
            p.classList.remove('hidden');
            
            document.getElementById('nombre-alumno-horario').innerText = alu.nom.toUpperCase();
            const container = document.getElementById('lista-materias-disponibles');
            
            const mats = CARRERAS[alu.car] || [];
            container.innerHTML = mats.map((m, mIdx) => `
                <div class="bg-white/5 p-6 rounded-[2rem] border border-white/10 space-y-4">
                    <div class="flex justify-between items-center border-b border-white/10 pb-4">
                        <span class="text-xs font-black uppercase tracking-tighter">${m}</span>
                        <button onclick="eliminarMateria(${mIdx})" class="text-red-400 hover:text-white transition-colors"><i class="fa-solid fa-circle-minus"></i></button>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <select class="bg-slate-900 text-[10px] p-3 rounded-xl border-none text-white font-bold outline-none">
                            <option>LUN - MIE</option>
                            <option>MAR - JUE</option>
                            <option>VIERNES</option>
                            <option>SABATINO</option>
                        </select>
                        <select class="bg-slate-900 text-[10px] p-3 rounded-xl border-none text-white font-bold outline-none">
                            <option>07:00 - 09:00</option>
                            <option>09:00 - 11:00</option>
                            <option>11:00 - 13:00</option>
                            <option>16:00 - 18:00</option>
                            <option>18:00 - 20:00</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <select class="w-full bg-orange-600 text-[9px] p-3 rounded-xl border-none text-white font-black uppercase tracking-[0.2em] outline-none">
                            <option value="presencial">üìç Presencial</option>
                            <option value="hibrido">üíª H√≠brido</option>
                        </select>
                    </div>
                </div>
            `).join('') + `
                <div class="flex flex-col gap-4">
                    <button onclick="agregarMateria(${i})" class="bg-white/5 hover:bg-white/10 border-2 border-dashed border-white/20 p-8 rounded-[2rem] text-[10px] font-black uppercase transition-all">
                        <i class="fa-solid fa-plus mr-2"></i> A√±adir Materia Extra
                    </button>
                    <button onclick="guardarCambios()" class="bg-white text-orange-600 p-5 rounded-[2rem] text-xs font-black uppercase shadow-2xl hover:scale-105 active:scale-95 transition-all">
                        Guardar Horario Permanentemente
                    </button>
                </div>
            `;
        }

        function eliminarMateria(idx) {
            const alu = db_alumnos[alumnoIndexActual];
            CARRERAS[alu.car].splice(idx, 1);
            verHorario(alumnoIndexActual);
        }

        function agregarMateria(i) {
            const m = prompt("Nombre de la materia adicional:");
            if(m) {
                const alu = db_alumnos[i];
                if(!CARRERAS[alu.car]) CARRERAS[alu.car] = [];
                CARRERAS[alu.car].push(m);
                verHorario(i);
            }
        }

        async function guardarCambios() {
    const alu = db_alumnos[alumnoIndexActual];
    
    try {
        const response = await fetch('http://localhost:3000/api/save-alumno', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(alu)
        });
        
        const result = await response.json();
        if(result.status === 'success') {
            alert("‚úÖ DATOS SINCRONIZADOS CON EL SERVIDOR LOCAL");
            document.getElementById('panel-horarios').classList.add('hidden');
        }
    } catch (error) {
        alert("‚ùå ERROR: El servidor local no est√° encendido.");
        console.error(error);
    }
}
    </script>
</body>
</html>